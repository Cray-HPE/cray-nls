# Please refer to https://stash.us.cray.com/projects/CLOUD/repos/cray-charts/browse/stable/cray-service/values.yaml?at=refs%2Fheads%2Fmaster
# for more info on values you can set/override
# Note that cray-service.containers[*].image and cray-service.initContainers[*].image map values are one of the only structures that
# differ from the standard kubernetes container spec:
# image:
#   repository: ""
#   tag: "" (default = "latest")
#   pullPolicy: "" (default = "IfNotPresent")

# TODO: implement a solution to pass that information from Ansible to Helm instead of hardcoding it
# See https://connect.us.cray.com/jira/browse/CASMCLOUD-661

global:
  appVersion: 0.0.1

cray-service:
  type: "Deployment"
  nameOverride: "cray-nls"
  fullnameOverride: "cray-nls"
  priorityClassName: csm-high-priority-service
  replicaCount: 3
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - topologyKey: kubernetes.io/hostname
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - cray-nls
  strategy:
    rollingUpdate:
      maxUnavailable: 50%
    type: RollingUpdate
  etcdCluster:
    enabled: false
  containers:
    cray-nls:
      name: "cray-nls"
      image:
        repository: artifactory.algol60.net/csm-docker/stable/cray-nls
        tag: 0.0.1
      resources:
        limits:
          cpu: 4
          memory: 4Gi
        requests:
          cpu: 500m
          memory: 256Mi
      env:
        # SERVER_PORT=3000
        # ENV=development
        # ARGO_TOKEN=
        # ARGO_SERVER_URL=localhost:2746
        - name: SERVER_PORT
          value: "3000"
        - name: ENV
          value: production
        - name: GIN_MODE
          value: release
        - name: ARGO_SERVER_URL
          value: argo-server.argo.svc:2746
      ports:
        - name: http
          containerPort: 3000
      livenessProbe:
        httpGet:
          port: 3000
          path: /apis/nls/v1/liveness
        initialDelaySeconds: 5
        periodSeconds: 3
      readinessProbe:
        httpGet:
          port: 3000
          path: /apis/nls/v1/readiness
        initialDelaySeconds: 20
        periodSeconds: 60
  ingress:
    enabled: true
    prefix: /apis/bss
